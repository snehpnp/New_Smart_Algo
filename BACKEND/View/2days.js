// db.users.aggregate([
//     {
//       $match: {
//         license_type: "0",
//         Is_Active: "1",
//         Role: "USER",
//         $expr: {
//           $gte: [
//             {
//               $dateToString: {
//                 format: "%Y-%m-%d",
//                 date: "$EndDate"
//               }
//             },
//             {
//               $dateToString: {
//                 format: "%Y-%m-%d",
//                 date: new Date()
//               }
//             }
//           ]
//         }
//       }
//     },
//     {
//       $lookup: {
//         from: "broker_responses",
//         localField: "_id",
//         foreignField: "user_id",
//         as: "responses"
//       }
//     },
//     {
//       $match: {
//         "responses.order_id": { $ne: "" } // Filter out responses where order_id is not empty
//       }
//     },
//     {
//       $addFields: {
//         responseCount: { $size: "$responses" } // Add a field to store the count of responses
//       }
//     },
//     {
//       $match: {
//         responseCount: { $gt: 2 } // Filter out users with more than two responses
//       }
//     },
//     {
//       $group: {
//         _id: 1, // Use a constant value as the _id
//         users: { $push: { _id: "$_id", responses: "$responses" } } // Include _id and responses in the 'users' array
//       }
//     },
//     {
//       $project: {
//         _id: 0, // Exclude the _id field
//         users: {
//           $map: {
//             input: "$users",
//             as: "user",
//             in: {
//               _id: "$$user._id",
//               responses: {
//                 $map: {
//                   input: "$$user.responses",
//                   as: "response",
//                   in: {
//                     createdAt: {
//                       $dateToString: {
//                         format: "%Y-%m-%d",
//                         date: "$$response.createdAt"
//                       }
//                     }
//                     // Include other fields from the response if needed
//                   }
//                 }
//               }
//             }
//           }
//         }
//       }
//     }
//   ])
  
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================
// =======================================================================================================================================================



// db.users.aggregate(
//   [
//     {
//       $match: {
//         license_type: "0",
//         Is_Active: "1",
//         Role: "USER",
//         $expr: {
//           $gte: [
//             {
//               $dateToString: {
//                 format: "%Y-%m-%d",
//                 date: "$EndDate"
//               }
//             },
//             {
//               $dateToString: {
//                 format: "%Y-%m-%d",
//                 date: new Date()
//               }
//             }
//           ]
//         }
//       }
//     },
//     {
//       $lookup: {
//         from: "broker_responses",
//         localField: "_id",
//         foreignField: "user_id",
//         as: "responses"
//       }
//     },
//     {
//       $match: {
//         "responses.order_id": { $ne: "" } // Filter out responses where order_id is not empty
//       }
//     },
//     {
//       $group: {
//         _id: 1, // Use a constant value as the _id
//         users: { $push: { _id: "$_id", responses: "$responses" } } // Include _id and responses in the 'users' array
//       }
//     },
//     {
//       $project: {
//         _id: 0, // Exclude the _id field
//         users: {
//           $map: {
//             input: "$users",
//             as: "user",
//             in: {
//               _id: "$$user._id",
//               responses: {
//                 $map: {
//                   input: "$$user.responses",
//                   as: "response",
//                   in: {
//                     createdAt: {
//                       $dateToString: {
//                         format: "%Y-%m-%d",
//                         date: "$$response.createdAt"
//                       }
//                     },
//                     // Include other fields from the response if needed
//                   }
//                 }
//               }
//             }
//           }
//         }
//       }
//     }
//   ])
  